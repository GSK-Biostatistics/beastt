<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normal Outcome (Known SD) • beastt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Normal Outcome (Known SD)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary.html">Binary Outcome</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Normal Outcome (Known SD)</a>
    </li>
    <li>
      <a href="../articles/tte.html">Time-to-Event Outcome</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GSK-Biostatistics/beastt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Normal Outcome (Known SD)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/v0.0.3/vignettes/continuous.Rmd" class="external-link"><code>vignettes/continuous.Rmd</code></a></small>
      <div class="hidden name"><code>continuous.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this example, we illustrate how to use Bayesian dynamic borrowing
(BDB) with the inclusion of inverse probability weighting to balance
baseline covariate distributions between external and internal datasets
(Psioda et al., <a href="https://doi.org/10.1080/10543406.2025.2489285" class="external-link">2025</a>). This
particular example considers a hypothetical trial with a cross sectional
normal outcome and a known standard deviation (SD) in each treatment arm
(external control arm and both internal arms), and our objective is to
use BDB with IPWs to construct a posterior distribution for the control
mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="data-description">Data Description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<p>We will use simulated internal and external datasets from the package
where each dataset has a normally distributed response variable and four
baseline covariates which we will balance.</p>
<p>The external control dataset has a sample size of 150 participants,
and the distributions of the four covariates are as follows:</p>
<ul>
<li><p>Covariate 1: normal with a mean and standard deviation of
approximately 50 and 10, respectively</p></li>
<li><p>Covariate 2: binary (0 vs. 1) with approximately 20% of
participants with level 1</p></li>
<li><p>Covariate 3: binary (0 vs. 1) with approximately 60% of
participants with level 1</p></li>
<li><p>Covariate 4: binary (0 vs. 1) with approximately 30% of
participants with level 1</p></li>
</ul>
<p>The internal dataset has 120 participants with 60 participants in
each of the control and active treatment arms. The covariate
distributions of each arm are as follows:</p>
<ul>
<li><p>Covariate 1: normal with a mean and standard deviation of
approximately 55 and 8, respectively</p></li>
<li><p>Covariate 2: binary (0 vs. 1) with approximately 30% of
participants with level 1</p></li>
<li><p>Covariate 3: binary (0 vs. 1) with approximately 50% of
participants with level 1</p></li>
<li><p>Covariate 4: binary (0 vs. 1) with approximately 30% of
participants with level 1</p></li>
</ul>
<p>We assume the standard deviations of both the external and internal
response data are known and equal to 0.15.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/" class="external-link">distributional</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">int_norm_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      subjid            cov1            cov2             cov3       </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   :32.00   Min.   :0.0000   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 30.75   1st Qu.:49.00   1st Qu.:0.0000   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median : 60.50   Median :55.00   Median :0.0000   Median :1.0000  </span></span>
<span><span class="co">#&gt;  Mean   : 60.50   Mean   :54.16   Mean   :0.2833   Mean   :0.5083  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 90.25   3rd Qu.:59.00   3rd Qu.:1.0000   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :120.00   Max.   :69.00   Max.   :1.0000   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;       cov4           trt            y            </span></span>
<span><span class="co">#&gt;  Min.   :0.00   Min.   :0.0   Min.   :-0.009368  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.00   1st Qu.:0.0   1st Qu.: 0.515350  </span></span>
<span><span class="co">#&gt;  Median :0.00   Median :0.5   Median : 0.683271  </span></span>
<span><span class="co">#&gt;  Mean   :0.25   Mean   :0.5   Mean   : 0.697266  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.25   3rd Qu.:1.0   3rd Qu.: 0.869011  </span></span>
<span><span class="co">#&gt;  Max.   :1.00   Max.   :1.0   Max.   : 1.399801</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ex_norm_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      subjid            cov1            cov2             cov3          cov4    </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   :27.00   Min.   :0.0000   Min.   :0.0   Min.   :0.0  </span></span>
<span><span class="co">#&gt;  1st Qu.: 38.25   1st Qu.:42.00   1st Qu.:0.0000   1st Qu.:0.0   1st Qu.:0.0  </span></span>
<span><span class="co">#&gt;  Median : 75.50   Median :48.00   Median :0.0000   Median :0.5   Median :0.0  </span></span>
<span><span class="co">#&gt;  Mean   : 75.50   Mean   :49.03   Mean   :0.2267   Mean   :0.5   Mean   :0.3  </span></span>
<span><span class="co">#&gt;  3rd Qu.:112.75   3rd Qu.:55.00   3rd Qu.:0.0000   3rd Qu.:1.0   3rd Qu.:1.0  </span></span>
<span><span class="co">#&gt;  Max.   :150.00   Max.   :75.00   Max.   :1.0000   Max.   :1.0   Max.   :1.0  </span></span>
<span><span class="co">#&gt;        y          </span></span>
<span><span class="co">#&gt;  Min.   :-0.2778  </span></span>
<span><span class="co">#&gt;  1st Qu.: 0.3669  </span></span>
<span><span class="co">#&gt;  Median : 0.5921  </span></span>
<span><span class="co">#&gt;  Mean   : 0.5893  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 0.8277  </span></span>
<span><span class="co">#&gt;  Max.   : 1.3438</span></span>
<span><span class="va">sd_external_control</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span>
<span><span class="va">sd_internal_control</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span>
<span><span class="va">sd_internal_treated</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="propensity-scores-and-inverse-probability-weights">Propensity Scores and Inverse Probability Weights<a class="anchor" aria-label="anchor" href="#propensity-scores-and-inverse-probability-weights"></a>
</h2>
<p>With the covariate data from both the external and internal datasets,
we can calculate the propensity scores and ATT inverse probability
weights (IPWs) for the internal and external control participants using
the <code>calc_prop_scr</code> function. This creates a propensity score
object which we can use for calculating an inverse probability weighted
power prior in the next step.</p>
<p><strong>Note: when reading external and internal datasets into
<code>calc_prop_scr</code>, be sure to include only the arms in which
you want to balance the covariate distributions (typically the internal
and external control arms).</strong> In this example, we want to balance
the covariate distributions of the external control arm to be similar to
those of the internal control arm, so we will exclude the internal
active treatment arm data from this function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps_model</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span></span>
<span><span class="va">ps_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prop_scr.html">calc_prop_scr</a></span><span class="op">(</span>internal_df <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>                        external_df <span class="op">=</span> <span class="va">ex_norm_df</span>, </span>
<span>                        id_col <span class="op">=</span> <span class="va">subjid</span>,</span>
<span>                        model <span class="op">=</span> <span class="va">ps_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_obj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Model</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> cov1 + cov2 + cov3 + cov4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Propensity Scores and Weights</span> <span style="color: #00BBBB;">───────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Effective sample size of the external arm: 61</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 4</span></span></span>
<span><span class="co">#&gt;    subjid Internal `Propensity Score` `Inverse Probability Weight`</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 FALSE                 0.181                        0.221</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2 FALSE                 0.351                        0.542</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3 FALSE                 0.456                        0.840</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4 FALSE                 0.115                        0.130</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5 FALSE                 0.364                        0.572</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6 FALSE                 0.377                        0.604</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7 FALSE                 0.131                        0.150</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8 FALSE                 0.259                        0.349</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9 FALSE                 0.235                        0.308</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10 FALSE                 0.207                        0.261</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 140 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Absolute Standardized Mean Difference</span> <span style="color: #00BBBB;">───────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   covariate diff_unadj diff_adj</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cov1          0.506   0.104  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cov2          0.054<span style="text-decoration: underline;">8</span>  0.104  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cov3          0.066<span style="text-decoration: underline;">7</span>  0.001<span style="text-decoration: underline;">15</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cov4          0.275   0.002<span style="text-decoration: underline;">66</span></span></span></code></pre></div>
<p>In order to check the suitability of the external data, we can create
a variety of diagnostic plots. The first plot we might want is a
histogram of the overlapping propensity score distributions from both
datasets. To get this, we use the <code>prop_scr_hist</code> function.
This function takes in the propensity score object made in the previous
step, and we can optionally supply the variable we want to look at
(either the propensity score or the IPW). By default, it will plot the
propensity scores. Additionally, we can look at the densities rather
than histograms by using the <code>prop_scr_dens</code> function. When
looking at the IPWs with either the histogram or the density functions,
it is important to note that only the IPWs for external control
participants will be shown because the ATT IPWs for all internal control
participants are equal to 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_hist.html">prop_scr_hist</a></span><span class="op">(</span><span class="va">ps_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_dens.html">prop_scr_dens</a></span><span class="op">(</span><span class="va">ps_obj</span>, variable <span class="op">=</span> <span class="st">"ipw"</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>The final plot we might want to look at is a love plot to visualize
the absolute standardized mean differences (both unadjusted and adjusted
by the IPWs) of the covariates between the internal and external data.
To do this, we use the <code>prop_scr_love</code> function. Like the
previous function, the only required parameter for this function is the
propensity score object, but we can also provide a location along the
x-axis for a vertical reference line.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_love.html">prop_scr_love</a></span><span class="op">(</span><span class="va">ps_obj</span>, reference_line <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="inverse-probability-weighted-power-prior">Inverse Probability Weighted Power Prior<a class="anchor" aria-label="anchor" href="#inverse-probability-weighted-power-prior"></a>
</h2>
<p>Now that we have created and assessed our propensity score object, we
can read it into the <code>calc_power_prior_norm</code> function to
calculate a normal inverse probability weighted power prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>.
To calculate the power prior, we need to supply the following
information:</p>
<ul>
<li><p>weighted object (the propensity score object we created
above)</p></li>
<li><p>response variable name (in this case
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>)</p></li>
<li><p>initial prior, in the form of a normal distributional object
(e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.5</mn><mo>,</mo><mtext mathvariant="normal">sd</mtext><mo>=</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mbox{N}(0.5, \mbox{sd} = 10)</annotation></semantics></math>)</p></li>
<li><p>SD of the external control response data, assumed known</p></li>
</ul>
<p>The prior and the external control SD are optional. If no prior is
provided, an improper uniform prior will be used for the initial prior;
i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>C</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\pi(\theta_C) \propto 1</annotation></semantics></math>.
If no external control SD or initial prior are specified (i.e., both the
<code>prior</code> and <code>external_sd</code> arguments are set as
<code>NULL</code>), then a non-standardized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
power prior will be created (not covered in this vignette). In this
example, we define the initial prior to be a vague normal distribution
with a mean 0.5 and SD 10.</p>
<p>Once we have a power prior, we might want to plot it. To do that, we
use the <code>plot_dist</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwr_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_power_prior_norm.html">calc_power_prior_norm</a></span><span class="op">(</span><span class="va">ps_obj</span>,</span>
<span>                                   response <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                   prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                                   external_sd <span class="op">=</span> <span class="va">sd_external_control</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_dist.html">plot_dist</a></span><span class="op">(</span><span class="va">pwr_prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="inverse-probability-weighted-robust-mixture-prior">Inverse Probability Weighted Robust Mixture Prior<a class="anchor" aria-label="anchor" href="#inverse-probability-weighted-robust-mixture-prior"></a>
</h2>
<p>We can robustify the normal power prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
by adding a vague component to create a robust mixture prior (RMP). We
define the vague component to be a normal distribution with the same
mean as the power prior and a variance that is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>e</mi><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">n_{ex}</annotation></semantics></math>
times greater than the variance of the power prior, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>e</mi><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">n_{ex}</annotation></semantics></math>
denotes the sample size of the external control arm. To construct the
RMP with two components, we use the <code>robustify_norm</code> function
and place 0.5 weight on each component. The two components of the
resulting RMP are labeled as “informative” and “vague”.</p>
<p>As an alternative to using <code>robustify_norm</code>, we can
instead use the <code>dist_mixture</code> function to create a mixture
prior with an arbitrary number of normal and/or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
components. If any component of the prior is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
distribution, the component will be approximated with the mixture of two
normal distributions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_external</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ex_norm_df</span><span class="op">)</span></span>
<span><span class="va">mix_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/robustify_norm.html">robustify_norm</a></span><span class="op">(</span><span class="va">pwr_prior</span>, <span class="va">n_external</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_dist.html">plot_dist</a></span><span class="op">(</span><span class="st">"Power Prior"</span> <span class="op">=</span> <span class="va">pwr_prior</span>,</span>
<span>          <span class="st">"Vague Prior"</span> <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="../reference/mix_means.html">mix_means</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span>,</span>
<span>                                      sd <span class="op">=</span> <span class="fu"><a href="../reference/mix_sigmas.html">mix_sigmas</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          <span class="st">"Robust Mixture Prior"</span> <span class="op">=</span> <span class="va">mix_prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="posterior-distributions">Posterior Distributions<a class="anchor" aria-label="anchor" href="#posterior-distributions"></a>
</h2>
<p>To create a posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>,
we can pass the resulting RMP to the <code>calc_post_norm</code>
function. By assuming the SD of the internal response data to be known,
the resulting posterior distribution is also a mixture of normal
components (the case when the SD is unknown is not covered in this
vignette).</p>
<p><strong>Note: when reading internal data directly into
<code>calc_post_norm</code>, be sure to include only the arm of interest
(e.g., the internal control arm if creating a posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>).</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_norm.html">calc_post_norm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                               response <span class="op">=</span> <span class="va">y</span>, </span>
<span>                               prior <span class="op">=</span> <span class="va">mix_prior</span>,</span>
<span>                               internal_sd <span class="op">=</span> <span class="va">sd_internal_control</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_dist.html">plot_dist</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Next, we create a posterior distribution for the mean of the active
treatment arm
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
by reading the internal data for the corresponding arm into the
<code>calc_post_norm</code> function while assuming the SD of the
internal active treatment arm to be equal to 0.15. In this case, we use
the vague component of the RMP as our normal prior.</p>
<p><strong>As noted earlier, be sure to read in only the data for the
internal active treatment arm while excluding the internal control
data.</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_norm.html">calc_post_norm</a></span><span class="op">(</span>internal_data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                               response <span class="op">=</span> <span class="va">y</span>,</span>
<span>                               prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="../reference/mix_means.html">mix_means</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span>,</span>
<span>                                                   sd <span class="op">=</span> <span class="fu"><a href="../reference/mix_sigmas.html">mix_sigmas</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                               internal_sd <span class="op">=</span> <span class="va">sd_internal_treated</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_dist.html">plot_dist</a></span><span class="op">(</span><span class="st">"Control Posterior"</span> <span class="op">=</span> <span class="va">post_control</span>,</span>
<span>          <span class="st">"Treatment Posterior"</span> <span class="op">=</span> <span class="va">post_treated</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="posterior-summary-statistics-and-samples">Posterior Summary Statistics and Samples<a class="anchor" aria-label="anchor" href="#posterior-summary-statistics-and-samples"></a>
</h2>
<p>With our posterior distributions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
saved as distributional objects, we can use several functions from the
<code>distributional</code> package to calculate posterior summary
statistics and sample from the distributions. Using the posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
as an example, we illustrate several of these functions below.</p>
<ul>
<li>Posterior summary statistics:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>,</span>
<span>  median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>,</span>
<span>  variance <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/variance.html" class="external-link">variance</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        mean      median    variance </span></span>
<span><span class="co">#&gt; 0.675091383 0.675734273 0.000239683</span></span></code></pre></div>
<ul>
<li>Highest density regions using the <code>hdr</code> function:</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/hdr.html" class="external-link">hdr</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>        <span class="co"># 95% HDR</span></span>
<span><span class="co">#&gt; &lt;hdr[1]&gt;</span></span>
<span><span class="co">#&gt; [1] [0.6442579, 0.7052676]95</span></span>
<span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/hdr.html" class="external-link">hdr</a></span><span class="op">(</span><span class="va">post_control</span>, <span class="fl">90</span><span class="op">)</span>    <span class="co"># 90% HDR</span></span>
<span><span class="co">#&gt; &lt;hdr[1]&gt;</span></span>
<span><span class="co">#&gt; [1] [0.650438, 0.7006585]90</span></span></code></pre></div>
<ul>
<li>Credible intervals using either the <code>hilo</code> function or
the <code>quantile</code> function:</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/hilo.html" class="external-link">hilo</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>       <span class="co"># 95% credible interval</span></span>
<span><span class="co">#&gt; &lt;hilo[1]&gt;</span></span>
<span><span class="co">#&gt; [1] [0.6420707, 0.7036551]95</span></span>
<span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/hilo.html" class="external-link">hilo</a></span><span class="op">(</span><span class="va">post_control</span>, <span class="fl">90</span><span class="op">)</span>   <span class="co"># 90% credible interval</span></span>
<span><span class="co">#&gt; &lt;hilo[1]&gt;</span></span>
<span><span class="co">#&gt; [1] [0.6487183, 0.6992243]90</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">post_control</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>    <span class="co"># 95% CrI via quantile function</span></span>
<span><span class="co">#&gt; [1] 0.6420707 0.7036551</span></span></code></pre></div>
<ul>
<li>Posterior probabilities (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>C</mi></msub><mo>&lt;</mo><mn>0.7</mn><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Pr(\theta_C &lt; 0.7 | D)</annotation></semantics></math>)
using the <code>cdf</code> function:</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/cdf.html" class="external-link">cdf</a></span><span class="op">(</span><span class="va">post_control</span>, q <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>   <span class="co"># Pr(theta_C &lt; 0.7 | D)</span></span>
<span><span class="co">#&gt; [1] 0.9554074</span></span></code></pre></div>
<ul>
<li>Posterior (log) densities at a given value:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">post_control</span>, at <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>                <span class="co"># density at 0.7</span></span>
<span><span class="co">#&gt; [1] 6.659121</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">post_control</span>, at <span class="op">=</span> <span class="fl">.7</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>    <span class="co"># log density at 0.7</span></span>
<span><span class="co">#&gt; [1] 1.895988</span></span></code></pre></div>
<p>In addition to calculating posterior summary statistics, we can
sample from posterior distributions using the <code>generate</code>
function. Here, we randomly sample 100,000 draws from the posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
and plot a histogram of the sample.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/generate.html" class="external-link">generate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">post_control</span>, times <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>samp <span class="op">=</span> <span class="va">samp_control</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">samp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Density"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="va">C</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Posterior Samples of "</span>, <span class="va">theta</span><span class="op">[</span><span class="va">C</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#5398BE"</span>, fill <span class="op">=</span> <span class="st">"#5398BE"</span>,</span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, binwidth <span class="op">=</span> <span class="fl">.01</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Similarly, we sample from the posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/generate.html" class="external-link">generate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">post_treated</span>, times <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>samp <span class="op">=</span> <span class="va">samp_treated</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">samp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Density"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="cn">T</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Posterior Samples of "</span>, <span class="va">theta</span><span class="op">[</span><span class="cn">T</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#FFA21F"</span>, fill <span class="op">=</span> <span class="st">"#FFA21F"</span>,</span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, binwidth <span class="op">=</span> <span class="fl">.01</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>We define our marginal treatment effect to be the difference between
the active treatment mean and the control mean (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">\theta_T - \theta_C</annotation></semantics></math>).
We can obtain a sample from the posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">\theta_T - \theta_C</annotation></semantics></math>
by subtracting the posterior sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
from the posterior sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_trt_diff</span> <span class="op">&lt;-</span> <span class="va">samp_treated</span> <span class="op">-</span> <span class="va">samp_control</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>samp <span class="op">=</span> <span class="va">samp_trt_diff</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">samp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Density"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="cn">T</span><span class="op">]</span>, <span class="st">" - "</span>, <span class="va">theta</span><span class="op">[</span><span class="va">C</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Posterior Samples of "</span>, <span class="va">theta</span><span class="op">[</span><span class="cn">T</span><span class="op">]</span>, <span class="st">" - "</span>, <span class="va">theta</span><span class="op">[</span><span class="va">C</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#FF0000"</span>, fill <span class="op">=</span> <span class="st">"#FF0000"</span>,</span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, binwidth <span class="op">=</span> <span class="fl">.01</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Suppose we want to test the hypotheses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: \theta_T - \theta_C \le 0</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub><mo>:</mo><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_1: \theta_T - \theta_C &gt; 0</annotation></semantics></math>.
We can use our posterior sample for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">\theta_T - \theta_C</annotation></semantics></math>
to calculate the posterior probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub><mo>&gt;</mo><mn>0</mn><mo>∣</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Pr(\theta_T - \theta_C &gt; 0 \mid D)</annotation></semantics></math>
(i.e., the probability in favor of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>1</mn></msub><annotation encoding="application/x-tex">H_1</annotation></semantics></math>),
and we conclude that we have sufficient evidence in favor of the
alternative hypothesis if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>T</mi></msub><mo>−</mo><msub><mi>θ</mi><mi>C</mi></msub><mo>&gt;</mo><mn>0</mn><mo>∣</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0.975</mn></mrow><annotation encoding="application/x-tex">Pr(\theta_T - \theta_C &gt; 0 \mid D) &gt; 0.975</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">samp_trt_diff</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.98861</span></span></code></pre></div>
<p>We see that this posterior probability is greater than 0.975, and
hence we have sufficient evidence to support the alternative
hypothesis.</p>
<p>Using the <code>parameters</code> function from the
<code>distributional</code> package, we can extract the parameters of a
posterior distribution that consists of a single component (i.e., a
single normal distribution). For example, we can extract the mean (mu)
and standard deviation (sigma) parameters of the beta posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/parameters.html" class="external-link">parameters</a></span><span class="op">(</span><span class="va">post_treated</span><span class="op">)</span></span>
<span><span class="co">#&gt;          mu      sigma</span></span>
<span><span class="co">#&gt; 1 0.7307423 0.01929926</span></span></code></pre></div>
<p>For posterior distributions that are a mixture of normal components,
we can extract the means and standard deviations of each component using
the <code>mix_means</code> and <code>mix_sigmas</code> functions,
respectively.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mix_means.html">mix_means</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>    <span class="co"># means of each normal component</span></span>
<span><span class="co">#&gt; informative       vague </span></span>
<span><span class="co">#&gt;   0.6772442   0.6636995</span></span>
<span><span class="fu"><a href="../reference/mix_sigmas.html">mix_sigmas</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>   <span class="co"># SDs of each normal component</span></span>
<span><span class="co">#&gt; informative       vague </span></span>
<span><span class="co">#&gt;  0.01361736  0.01929926</span></span></code></pre></div>
<p>We can also use the <code>parameters</code> function to extract the
mixture weights associated with the normal components of the posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/parameters.html" class="external-link">parameters</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span><span class="op">$</span><span class="va">w</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; informative       vague </span></span>
<span><span class="co">#&gt;   0.8410606   0.1589394</span></span></code></pre></div>
<p>Lastly, we calculate the effective sample size of the posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
using the method by Pennello and Thompson (2008). To do so, we first
must construct the posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math><em>without borrowing from the external control data</em> (e.g., using a
vague prior).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_control_no_brrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_norm.html">calc_post_norm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                       response <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="../reference/mix_means.html">mix_means</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span>,</span>
<span>                                                           sd <span class="op">=</span> <span class="fu"><a href="../reference/mix_sigmas.html">mix_sigmas</a></span><span class="op">(</span><span class="va">mix_prior</span><span class="op">)</span><span class="op">[</span><span class="st">"vague"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                       internal_sd <span class="op">=</span> <span class="va">sd_internal_control</span><span class="op">)</span></span>
<span><span class="va">n_int_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>   <span class="co"># sample size of internal control arm</span></span>
<span><span class="va">var_no_brrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/variance.html" class="external-link">variance</a></span><span class="op">(</span><span class="va">post_control_no_brrw</span><span class="op">)</span>       <span class="co"># post variance of theta_C without borrowing</span></span>
<span><span class="va">var_brrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/variance.html" class="external-link">variance</a></span><span class="op">(</span><span class="va">post_control</span><span class="op">)</span>                  <span class="co"># post variance of theta_C with borrowing</span></span>
<span><span class="va">ess</span> <span class="op">&lt;-</span> <span class="va">n_int_ctrl</span> <span class="op">*</span> <span class="va">var_no_brrw</span> <span class="op">/</span> <span class="va">var_brrw</span>          <span class="co"># effective sample size</span></span>
<span><span class="va">ess</span></span>
<span><span class="co">#&gt; [1] 93.23853</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Psioda, M. A., Bean, N. W., Wright, B. A., Lu, Y., Mantero, A., and
Majumdar, A. (2025). Inverse probability weighted Bayesian dynamic
borrowing for estimation of marginal treatment effects with application
to hybrid control arm oncology studies. <em>Journal of Biopharmaceutical
Statistics</em>, 1–23. DOI: <a href="https://doi.org/10.1080/10543406.2025.2489285" class="external-link">10.1080/10543406.2025.2489285</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christina Fillmore, Nate Bean, Abi Terry, Ben Arancibia, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
