<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continuous Case â€¢ beastt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Continuous Case">
<meta property="og:description" content="beastt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/continuous.html">Continuous Case</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Package Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Continuous Case</h1>
            
      
      
      <div class="hidden name"><code>continuous.Rmd</code></div>

    </div>

    
    
<p>For this example we are going to walk through how to use Bayesian
dynamic borrowing with propensity score matching. The first thing we
need is some data. I am going to start with external control data that
has come covariates</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">beastt</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/" class="external-link">distributional</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Make the external dataset</span></span>
<span><span class="va">n_external</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">sd_external_control</span> <span class="op">=</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">external_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>subjid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_external</span>,   <span class="co"># participant ID</span></span>
<span>                 cov1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_external</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,   <span class="co"># covariate 1</span></span>
<span>                 cov2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_external</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span>,          <span class="co"># covariate 2  (binary): ~20% level 1</span></span>
<span>                 cov3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_external</span>, <span class="fl">1</span>, <span class="fl">.6</span><span class="op">)</span>,          <span class="co"># covariate 3  (binary): ~60% level 1</span></span>
<span>                 cov4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_external</span>, <span class="fl">1</span>, <span class="fl">.3</span><span class="op">)</span>,          <span class="co"># covariate 4  (binary): ~30% level 1</span></span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_external</span>, mean <span class="op">=</span> <span class="fl">45</span>, sd <span class="op">=</span> <span class="va">sd_external_control</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span></span>
<span><span class="co">## Make the internal dataset</span></span>
<span></span>
<span><span class="co"># Sample sizes</span></span>
<span><span class="va">n_inter_control</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">n_inter_treat</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">n_internal</span> <span class="op">&lt;-</span> <span class="va">n_inter_control</span> <span class="op">+</span> <span class="va">n_inter_treat</span>     <span class="co"># total internal sample size</span></span>
<span></span>
<span><span class="va">internal_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>subjid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_internal</span>,                  <span class="co"># participant ID</span></span>
<span>                  cov1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_internal</span>, <span class="fl">55</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,          <span class="co"># covariate 1: mean=55, SD=8 (not mean=50, SD=10)</span></span>
<span>                  cov2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_internal</span>, <span class="fl">1</span>, <span class="fl">.3</span><span class="op">)</span>,                <span class="co"># covariate 2: ~30% level 1 (not 20%)</span></span>
<span>                  cov3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_internal</span>, <span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>,                <span class="co"># covariate 3: ~50% level 1 (not 60%)</span></span>
<span>                  cov4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_internal</span>, <span class="fl">1</span>, <span class="fl">.3</span><span class="op">)</span>,                <span class="co"># covariate 4: ~30% level 1 (same)</span></span>
<span>                  trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_inter_control</span>, <span class="va">n_inter_treat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_internal</span>, mean <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>    <span class="co"># treatment (0: control, 1: active treatment)</span></span></code></pre></div>
<p>Now we have some data we can calculate the propensity scores for the
internal and external controls using the <code>calc_prop_scr</code>
function. This creates a propensity score object which we can use for
calculating power priors in the next step.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps_model</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span></span>
<span><span class="va">ps_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prop_scr.html">calc_prop_scr</a></span><span class="op">(</span>internal_df <span class="op">=</span> <span class="va">internal_df</span>, </span>
<span>                        external_df <span class="op">=</span> <span class="va">external_df</span>, </span>
<span>                        id_col <span class="op">=</span> <span class="va">subjid</span>,</span>
<span>                          model <span class="op">=</span> <span class="va">ps_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_obj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Model</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â€¢</span> cov1 + cov2 + cov3 + cov4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Propensity Scores and Weights</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 Ã— 4</span></span></span>
<span><span class="co">#&gt;    subjid Internal `Propensity Score` `Inverse Probablity Weight`</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 FALSE                 0.314                       0.458</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2 FALSE                 0.365                       0.576</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3 FALSE                 0.618                       1.62 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4 FALSE                 0.406                       0.684</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5 FALSE                 0.406                       0.684</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6 FALSE                 0.644                       1.81 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7 FALSE                 0.515                       1.06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8 FALSE                 0.245                       0.324</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9 FALSE                 0.302                       0.432</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10 FALSE                 0.339                       0.514</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># â„¹ 140 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Absolute Standardized Mean Difference</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 Ã— 3</span></span></span>
<span><span class="co">#&gt;   covariate diff_unadj diff_adj</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cov1          0.526    0.123 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cov2          0.134    0.052<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cov3          0.135    0.090<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cov4          0.099<span style="text-decoration: underline;">9</span>   0.072<span style="text-decoration: underline;">9</span></span></span></code></pre></div>
<p>In order to check the suitability of the external data we can create
a variety of diagnostic plots. The first plot we might want is a
histogram. To get that we are going to use the
<code>prop_scr_hist</code> function. This function takes in the
propensity score object made in the previous step. Then we can
optionally supply the variable we want to look at, either the propensity
score or the inverse probability weight. By default it will plot the
propensity scores. Additionally, we can look at the densities rather
than histograms by using the <code>prop_scr_dens</code> function. When
looking at the inverse probability weights with either the histogram or
the density functions, it is important to note only the external data
will be shown because value of the internal data will just be 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_hist.html">prop_scr_hist</a></span><span class="op">(</span><span class="va">ps_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_dens.html">prop_scr_dens</a></span><span class="op">(</span><span class="va">ps_obj</span>, variable <span class="op">=</span> <span class="st">"ipw"</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>The final plot we might want to look at is a love plot to visualize
the standard mean differences of the covariates between the internal and
external data. To do this we are just going to use the â€˜prop_scr_loveâ€™
function. Like the previous function the only required parameter for
this function is the propensity score object, but we can also provide a
location for a reference line.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_love.html">prop_scr_love</a></span><span class="op">(</span><span class="va">ps_obj</span>, reference_line <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Now that we are happy with our propensity score we can use it to
calculate a power prior. To calculate the power prior we need to
supply:</p>
<ul>
<li><p>prior, in the form of a distirbutional object</p></li>
<li><p>propensity score object, what we created above</p></li>
<li><p>response variable</p></li>
<li><p>external control sd, this we need because the data here is
continuous. If left out then an improper prior will be use assuming
proportionality to one</p></li>
</ul>
<p>Finally, once we have a power prior we might want to plot it. To do
that we can just the <code>plot_dist</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwr_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_power_prior.html">calc_power_prior</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span><span class="fl">92</span>, <span class="fl">100</span><span class="op">)</span>, </span>
<span>                 <span class="va">ps_obj</span>, response <span class="op">=</span> <span class="va">y</span>, </span>
<span>                 external_control_sd <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_dist.html">plot_dist</a></span><span class="op">(</span><span class="va">pwr_prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christina Fillmore, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
