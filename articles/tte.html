<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weibull Endpoint with Borrowing from an External Control Arm • beastt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Weibull Endpoint with Borrowing from an External Control Arm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary.html">Binary Endpoint Case - Borrowing from an External Control Arm</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Normal Endpoint Case with Assumed Known SD - Borrowing from an External Control Arm</a>
    </li>
    <li>
      <a href="../articles/tte.html">Weibull Endpoint with Borrowing from an External Control Arm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GSK-Biostatistics/beastt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Weibull Endpoint with Borrowing from an External
Control Arm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/main/vignettes/tte.Rmd" class="external-link"><code>vignettes/tte.Rmd</code></a></small>
      <div class="hidden name"><code>tte.Rmd</code></div>

    </div>

    
    
<p>In this example, we are going to walk through how to use Bayesian
dynamic borrowing (BDB) with the inclusion of inverse probability
weighting to balance baseline covariate distributions between external
and internal datasets. This particular example considers a hypothetical
trial with a cross sectional normal endpoint and a known standard
deviation (SD) in each treatment arm (external control arm and both
internal arms), and our objective is to use BDB with IPWs to construct a
posterior distribution for the control mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>.
We will use simulated internal and external datasets from the package
where each dataset has a normally distributed response variable and four
baseline covariates which we will balance.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/" class="external-link">distributional</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rstan version 2.32.6 (Stan version 2.32.2)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">#&gt; For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">#&gt; change `threads_per_chain` option:</span></span>
<span><span class="co">#&gt; rstan_options(threads_per_chain = 1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">int_tte_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      subjid             y              enr_time         total_time    </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   : 0.1892   Min.   :0.01987   Min.   : 1.432  </span></span>
<span><span class="co">#&gt;  1st Qu.: 40.75   1st Qu.: 5.3278   1st Qu.:0.87908   1st Qu.: 6.511  </span></span>
<span><span class="co">#&gt;  Median : 80.50   Median :10.4954   Median :1.28968   Median :11.931  </span></span>
<span><span class="co">#&gt;  Mean   : 80.50   Mean   : 8.9459   Mean   :1.21703   Mean   :14.374  </span></span>
<span><span class="co">#&gt;  3rd Qu.:120.25   3rd Qu.:12.6821   3rd Qu.:1.61900   3rd Qu.:19.743  </span></span>
<span><span class="co">#&gt;  Max.   :160.00   Max.   :14.0941   Max.   :1.97276   Max.   :72.680  </span></span>
<span><span class="co">#&gt;      event             trt           cov1            cov2          cov3       </span></span>
<span><span class="co">#&gt;  Min.   :0.0000   Min.   :0.0   Min.   :40.00   Min.   :0.0   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000   1st Qu.:0.0   1st Qu.:59.00   1st Qu.:0.0   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1.0000   Median :0.5   Median :64.00   Median :0.0   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   :0.5375   Mean   :0.5   Mean   :62.98   Mean   :0.4   Mean   :0.3937  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000   3rd Qu.:1.0   3rd Qu.:68.00   3rd Qu.:1.0   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000   Max.   :1.0   Max.   :80.00   Max.   :1.0   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;       cov4       </span></span>
<span><span class="co">#&gt;  Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1.0000  </span></span>
<span><span class="co">#&gt;  Mean   :0.5938  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ex_tte_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      subjid             y              enr_time         total_time     </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   : 0.1773   Min.   :0.05027   Min.   : 0.7369  </span></span>
<span><span class="co">#&gt;  1st Qu.: 38.25   1st Qu.: 4.7512   1st Qu.:0.74162   1st Qu.: 6.0451  </span></span>
<span><span class="co">#&gt;  Median : 75.50   Median : 9.5106   Median :1.14954   Median :11.1294  </span></span>
<span><span class="co">#&gt;  Mean   : 75.50   Mean   : 8.6711   Mean   :1.16447   Mean   :12.9894  </span></span>
<span><span class="co">#&gt;  3rd Qu.:112.75   3rd Qu.:12.7942   3rd Qu.:1.58006   3rd Qu.:18.0975  </span></span>
<span><span class="co">#&gt;  Max.   :150.00   Max.   :14.2055   Max.   :1.99648   Max.   :55.4580  </span></span>
<span><span class="co">#&gt;      event          cov1            cov2             cov3       </span></span>
<span><span class="co">#&gt;  Min.   :0.0   Min.   :40.00   Min.   :0.0000   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0   1st Qu.:57.25   1st Qu.:0.0000   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1.0   Median :66.00   Median :0.0000   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   :0.6   Mean   :65.21   Mean   :0.2733   Mean   :0.3667  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0   3rd Qu.:71.00   3rd Qu.:1.0000   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0   Max.   :93.00   Max.   :1.0000   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;       cov4       </span></span>
<span><span class="co">#&gt;  Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1.0000  </span></span>
<span><span class="co">#&gt;  Mean   :0.5267  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000</span></span>
<span><span class="va">n_external</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ex_tte_df</span><span class="op">)</span></span></code></pre></div>
<p>With the covariate data from both the external and internal datasets,
we can calculate the propensity scores and ATT inverse probability
weights (IPWs) for the internal and external controls using the
<code>calc_prop_scr</code> function. This creates a propensity score
object which we can use for calculating an inverse probability weighted
power prior in the next step.</p>
<p><strong>Note: when reading external and internal datasets into
<code>calc_prop_scr</code>, be sure to include only the treatment arms
across which you want to balance the covariate distributions.</strong>
In this example, we want to balance the covariate distributions of the
external control arm to be similar to those of the internal control arm,
so we will exclude the internal active treatment arm data from this
function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps_model</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span></span>
<span><span class="va">ps_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prop_scr.html">calc_prop_scr</a></span><span class="op">(</span>internal_df <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_tte_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>                        external_df <span class="op">=</span> <span class="va">ex_tte_df</span>, </span>
<span>                        id_col <span class="op">=</span> <span class="va">subjid</span>,</span>
<span>                        model <span class="op">=</span> <span class="va">ps_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_obj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Model</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> cov1 + cov2 + cov3 + cov4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Propensity Scores and Weights</span> <span style="color: #00BBBB;">───────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 4</span></span></span>
<span><span class="co">#&gt;    subjid Internal `Propensity Score` `Inverse Probability Weight`</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 FALSE                 0.342                        0.520</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2 FALSE                 0.312                        0.453</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3 FALSE                 0.221                        0.284</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4 FALSE                 0.461                        0.854</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5 FALSE                 0.531                        1.13 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6 FALSE                 0.444                        0.798</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7 FALSE                 0.424                        0.735</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8 FALSE                 0.254                        0.340</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9 FALSE                 0.334                        0.501</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10 FALSE                 0.242                        0.319</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 140 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Absolute Standardized Mean Difference</span> <span style="color: #00BBBB;">───────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   covariate diff_unadj diff_adj</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cov1          0.323  0.036<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cov2          0.192  0.000<span style="text-decoration: underline;">289</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cov3          0.017<span style="text-decoration: underline;">3</span> 0.013<span style="text-decoration: underline;">2</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cov4          0.226  0.007<span style="text-decoration: underline;">15</span></span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">ps_obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 4</span></span></span>
<span><span class="co">#&gt;    subjid `___internal___` `___ps___` `___weight___`</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 FALSE                 0.342          0.520</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2 FALSE                 0.312          0.453</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3 FALSE                 0.221          0.284</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4 FALSE                 0.461          0.854</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5 FALSE                 0.531          1.13 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6 FALSE                 0.444          0.798</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7 FALSE                 0.424          0.735</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8 FALSE                 0.254          0.340</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9 FALSE                 0.334          0.501</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10 FALSE                 0.242          0.319</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 140 more rows</span></span></span></code></pre></div>
<p>In order to check the suitability of the external data, we can create
a variety of diagnostic plots. The first plot we might want is a
histogram of the overlapping propensity score distributions from both
datasets. To get this, we use the <code>prop_scr_hist</code> function.
This function takes in the propensity score object made in the previous
step, and we can optionally supply the variable we want to look at
(either the propensity score or the IPW). By default, it will plot the
propensity scores. Additionally, we can look at the densities rather
than histograms by using the <code>prop_scr_dens</code> function. When
looking at the IPWs with either the histogram or the density functions,
it is important to note that only the IPWs for external control
participants will be shown because the ATT IPWs of all internal control
participants are equal to 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_hist.html">prop_scr_hist</a></span><span class="op">(</span><span class="va">ps_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="tte_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_dens.html">prop_scr_dens</a></span><span class="op">(</span><span class="va">ps_obj</span>, variable <span class="op">=</span> <span class="st">"ipw"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tte_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>The final plot we might want to look at is a love plot to visualize
the absolute standard mean differences (both unadjusted and adjusted by
the IPWs) of the covariates between the internal and external data. To
do this, we use the <code>prop_scr_love</code> function. Like the
previous function, the only required parameter for this function is the
propensity score object, but we can also provide a location along the
x-axis for a vertical reference line.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prop_scr_love.html">prop_scr_love</a></span><span class="op">(</span><span class="va">ps_obj</span>, reference_line <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="tte_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwr_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_power_prior_weibull.html">calc_power_prior_weibull</a></span><span class="op">(</span></span>
<span>  <span class="va">ps_obj</span>,</span>
<span>  <span class="va">y</span>, <span class="va">event</span>, </span>
<span>  <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot_dist(pwr_prior)</span></span></code></pre></div>
<p>Now that we have a normal power prior, we can calculate the posterior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>
using the <code>calc_post_norm</code> function. By defining our prior to
be a normal distribution and by assuming the SD of the internal response
data to be known, the resulting posterior distribution will also be
normal (the case when the SD is unknown is not covered in this
vignette).</p>
<p><strong>Note: if reading internal data directly into
<code>calc_post_norm</code> instead of a propensity score object, be
sure to include only the treatment arm of interest (e.g., the internal
control arm if creating a posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>).</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_weibull.html">calc_post_weibull</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_tte_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                       response <span class="op">=</span> <span class="va">y</span>, event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                       prior <span class="op">=</span> <span class="va">pwr_prior</span>,</span>
<span>                       analysis_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir) : </span></span>
<span><span class="co">#&gt;   Exception: mismatch in number dimensions declared and found in context; processing stage=data initialization; variable name=cov_inf; dims declared=(2,2); dims found=(1,2,2) (in 'weibullpost', line 8, column 2 to column 22)</span></span>
<span><span class="co">#&gt; failed to create the sampler; sampling not done</span></span></code></pre></div>
<p>If we want to robustify our power prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>C</mi></msub><annotation encoding="application/x-tex">\theta_C</annotation></semantics></math>,
we can add a vague component to the power prior distribution we
previously created to construct a robust mixture prior which we can then
pass to <code>calc_post_norm</code>. In general, we can define our prior
to be a mixture distribution with an arbitrary number of normal and/or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
components. If any component of the prior is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
distribution, the prior will be approximated with the mixture of two
normal distributions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/robustify_norm.html">robustify_norm</a></span><span class="op">(</span><span class="va">pwr_prior</span>, <span class="va">n_external</span><span class="op">)</span></span>
<span><span class="co"># plot_dist("Robust Mixture Prior" = mixed_prior,</span></span>
<span><span class="co">#           "Power Prior" = pwr_prior)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_weibull.html">calc_post_weibull</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_tte_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                  <span class="va">y</span>, <span class="va">event</span>, <span class="va">mixed_prior</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vague_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_mixture.html" class="external-link">dist_mixture</a></span><span class="op">(</span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/parameters.html" class="external-link">parameters</a></span><span class="op">(</span><span class="va">mixed_prior</span><span class="op">)</span><span class="op">$</span><span class="va">dist</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trt_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_post_weibull.html">calc_post_weibull</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_tte_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  <span class="va">y</span>, <span class="va">event</span>, <span class="va">vague_only</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctl_post_ap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">cont_post</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"survProb"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">trt_post_ap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">trt_post</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"survProb"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Distribution of differences between treatment and control survival probabilities at prespecified time</span></span>
<span><span class="va">diff_post_ap2</span> <span class="op">&lt;-</span> <span class="va">trt_post_ap2</span> <span class="op">-</span> <span class="va">ctl_post_ap2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_post_ap2</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>    <span class="co"># post prob that diff in surv probs is greater than 0</span></span>
<span><span class="co">#&gt; [1] 0.7413</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christina Fillmore, Ben Arancibia, Nate Bean, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
