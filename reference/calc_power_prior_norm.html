<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate Power Prior Normal — calc_power_prior_norm • beastt</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Power Prior Normal — calc_power_prior_norm"><meta property="og:description" content="Calculate a (potentially inverse probability weighted) normal
power prior using external data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/binary.html">Binary Outcome</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Normal Outcome (Known SD)</a>
    </li>
    <li>
      <a href="../articles/tte.html">Time-to-Event Outcome</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/GSK-Biostatistics/beastt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Power Prior Normal</h1>
    <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/main/R/pwr_prior.R" class="external-link"><code>R/pwr_prior.R</code></a></small>
    <div class="hidden name"><code>calc_power_prior_norm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate a (potentially inverse probability weighted) normal
power prior using external data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_power_prior_norm</span><span class="op">(</span></span>
<span>  <span class="va">external_data</span>,</span>
<span>  <span class="va">response</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  external_sd <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-external-data">external_data<a class="anchor" aria-label="anchor" href="#arg-external-data"></a></dt>
<dd><p>This can either be a <code>prop_scr_obj</code> created by calling
<code>create_prop_scr()</code> or a tibble of the external data. If it is just a
tibble the weights will be assumed to be 1. Only the external data for the
arm(s) of interest should be included in this object (e.g., external
control data if creating a power prior for the control mean)</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>Name of response variable</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>Either <code>NULL</code> or a normal distributional object that is the
initial prior for the parameter of interest (e.g., control mean) before the
external data are observed</p></dd>


<dt id="arg-external-sd">external_sd<a class="anchor" aria-label="anchor" href="#arg-external-sd"></a></dt>
<dd><p>Standard deviation of external response data if assumed
known. It can be left as <code>NULL</code> if assumed unknown</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Normal power prior object</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Weighted participant-level response data from an external study are
incorporated into an inverse probability weighted (IPW) power prior for the
parameter of interest \(\theta\) (e.g., the control mean if borrowing
from an external control arm). When borrowing information from an external
dataset of size \(N_{E}\), the IPW likelihood of the external response
data \(\boldsymbol{y}_E\) with weights \(\hat{\boldsymbol{a}}_0\) is defined as</p>
<p>$$\mathcal{L}_E(\theta \mid \boldsymbol{y}_E, \hat{\boldsymbol{a}}_0,
  \sigma_{E}^2) \propto \exp \left( -\frac{1}{2 \sigma_{E}^2}
  \sum_{i=1}^{N_{E}} \hat{a}_{0i} (y_i - \theta)^2 \right).$$</p>
<p>The <code>prior</code> argument should be either a distributional object with a family
type of <code>normal</code> or <code>NULL</code>, corresponding to the use of a normal initial
prior or an improper uniform initial prior (i.e., \(\pi(\theta) \propto
  1\)), respectively.</p>
<p>The <code>external_sd</code> argument can be a positive value if the external standard
deviation is assumed known or left as <code>NULL</code> otherwise. If <code>external_sd = NULL</code>, then <code>prior</code> must be <code>NULL</code> to indicate the use of an improper
uniform initial prior for \(\theta\), and an improper prior is defined
for the unknown external standard deviation such that \(\pi(\sigma_E^2)
  \propto (\sigma_E^2)^{-1}\). The details of the IPW power prior for each
case are as follows:</p><dl><dt><code>external_sd = positive value</code> (\(\sigma_E^2\) known):</dt>
<dd><p>With
either a proper normal or an improper uniform initial prior, the IPW
weighted power prior for \(\theta\) is a normal distribution.</p></dd>

<dt><code>external_sd = NULL</code> (\(\sigma_E^2\) unknown):</dt>
<dd><p>With improper
priors for both \(\theta\) and \(\sigma_E^2\), the marginal IPW weighted
power prior for \(\theta\) after integrating over \(\sigma_E^2\) is
a non-standardized \(t\) distribution.</p></dd>


</dl><p>Defining the weights \(\hat{\boldsymbol{a}}_0\) to equal 1 results in a
conventional normal (or \(t\)) power prior if the external standard
deviation is known (unknown).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other power prior:
<code><a href="calc_power_prior_beta.html">calc_power_prior_beta</a>()</code>,
<code><a href="calc_power_prior_weibull.html">calc_power_prior_weibull</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/" class="external-link">distributional</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># This function can be used directly on the data</span></span></span>
<span class="r-in"><span><span class="fu">calc_power_prior_norm</span><span class="op">(</span><span class="va">ex_norm_df</span>,</span></span>
<span class="r-in"><span>                      response <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>                      prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      external_sd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;distribution[1]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] N(88, 0.022)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or this function can be used with a propensity score object</span></span></span>
<span class="r-in"><span><span class="va">ps_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="calc_prop_scr.html">calc_prop_scr</a></span><span class="op">(</span>internal_df <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_norm_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        external_df <span class="op">=</span> <span class="va">ex_norm_df</span>,</span></span>
<span class="r-in"><span>                        id_col <span class="op">=</span> <span class="va">subjid</span>,</span></span>
<span class="r-in"><span>                        model <span class="op">=</span> <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">calc_power_prior_norm</span><span class="op">(</span><span class="va">ps_obj</span>,</span></span>
<span class="r-in"><span>                      response <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>                      prior <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html" class="external-link">dist_normal</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      external_sd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;distribution[1]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] N(0.69, 0.00037)</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christina Fillmore, Ben Arancibia, Nate Bean, Abi Terry, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

