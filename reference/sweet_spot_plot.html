<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create Sweet Spot Plots for Multiple Simulation Scenarios — sweet_spot_plot • beastt</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create Sweet Spot Plots for Multiple Simulation Scenarios — sweet_spot_plot"><meta property="og:description" content='Create visualization plots to help identify the "sweet spot" in borrowing
strategies across different simulation scenarios. For each unique scenario
defined by the combination of variables in scenario_vars, the function
produces a plot showing power, type I error, and the distribution of the
design prior for the control marginal parameter for approaches with and
without borrowing.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/binary.html">Binary Outcome</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Normal Outcome (Known SD)</a>
    </li>
    <li>
      <a href="../articles/tte.html">Time-to-Event Outcome</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/GSK-Biostatistics/beastt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create Sweet Spot Plots for Multiple Simulation Scenarios</h1>
    <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/v0.0.3/R/sim-plots.R" class="external-link"><code>R/sim-plots.R</code></a></small>
    <div class="hidden name"><code>sweet_spot_plot.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create visualization plots to help identify the "sweet spot" in borrowing
strategies across different simulation scenarios. For each unique scenario
defined by the combination of variables in <code>scenario_vars</code>, the function
produces a plot showing power, type I error, and the distribution of the
design prior for the control marginal parameter for approaches with and
without borrowing.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sweet_spot_plot</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">scenario_vars</span>,</span>
<span>  <span class="va">trt_diff</span>,</span>
<span>  <span class="va">control_marg_param</span>,</span>
<span>  <span class="va">h0_prob</span>,</span>
<span>  <span class="va">h0_prob_no_borrowing</span>,</span>
<span>  design_prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  highlight <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>A data frame containing iteration-level simulation results.</p></dd>


<dt id="arg-scenario-vars">scenario_vars<a class="anchor" aria-label="anchor" href="#arg-scenario-vars"></a></dt>
<dd><p>A vector of quoted column names corresponding
to variables used to define unique simulation scenarios. Each unique
combination of values in these columns will generate a separate plot.</p></dd>


<dt id="arg-trt-diff">trt_diff<a class="anchor" aria-label="anchor" href="#arg-trt-diff"></a></dt>
<dd><p>An unquoted column name representing the treatment
difference. Used to identify scenarios with null effect (trt_diff = 0) for
type I error calculation.</p></dd>


<dt id="arg-control-marg-param">control_marg_param<a class="anchor" aria-label="anchor" href="#arg-control-marg-param"></a></dt>
<dd><p>An unquoted column name to be used as the x-axis in
the plots. This is typically the control endpoint of interest on the
marginal scale (e.g., control response rate).</p></dd>


<dt id="arg-h-prob">h0_prob<a class="anchor" aria-label="anchor" href="#arg-h-prob"></a></dt>
<dd><p>An unquoted column name containing the probability of
rejecting the null hypothesis when when borrowing external data.</p></dd>


<dt id="arg-h-prob-no-borrowing">h0_prob_no_borrowing<a class="anchor" aria-label="anchor" href="#arg-h-prob-no-borrowing"></a></dt>
<dd><p>An unquoted column name containing the
probability of rejecting the null hypothesis when not borrowing external
data.</p></dd>


<dt id="arg-design-prior">design_prior<a class="anchor" aria-label="anchor" href="#arg-design-prior"></a></dt>
<dd><p>An unquoted column name containing distributional objects
that represent the design prior distribution for the control marginal
parameter (e.g., posterior distribution using the external control data).
Used to aid visualization of which values of the control marginal parameter
are assumed to be plausible. Default is <code>NULL</code>, in which case no design
prior is plotted. See Details for more information.</p></dd>


<dt id="arg-highlight">highlight<a class="anchor" aria-label="anchor" href="#arg-highlight"></a></dt>
<dd><p>Logical value to indicate if you want sweet spot
highlighting or not. If <code>TRUE</code> the sweet spot (where borrowing increase
power and reduces type 1 error) will be highlighted.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list of ggplot objects, one for each unique scenario defined by
<code>scenario_vars</code>. Each plot shows:</p><ul><li><p>Power curves for the cases with and without borrowing</p></li>
<li><p>Type I error rates for the cases with and without borrowing</p></li>
<li><p>Distribution of the design prior (if <code>design_prior</code> is specified)</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function calculates power and type I error rates for BDB approaches
that borrow from external data (e.g., use of a robust mixture prior with positive
weight on the informative component) and an approach that does not
borrow from external data (e.g., use of a vague prior) under each scenario
and visualizes them together as a function of the underlying control marginal
parameter of interest (e.g., control response rate for binary outcomes) that
may vary as a result of drift. This helps identify the "sweet spot" where borrowing
results in higher power and lower type I error rates compared to not borrowing.
Type I error is calculated using scenarios where <code>trt_diff</code> equals 0, and power
is calculated for all scenarios with positive values of <code>trt_diff</code>.</p>
<p>If <code>design_prior</code> is non-<code>NULL</code>, the design prior distribution is included
in the plot to provide insight into which values of the control marginal
parameter are plausible given this assumed design prior. We note that
<code>design_prior</code> can represent any informative prior that potentially
incorporates the external control data (e.g., the posterior distribution of
the control marginal parameter constructed using the external data and a
vague prior). Each element of the vector corresponding to <code>design_prior</code> must
be a distributional object with a family equal to "beta", "normal", or
"mixture" (where each component is either "beta" or "normal"). For the
time-to-event case in which a multivariate normal prior is assumed for the
control log-shape and intercept of a Weibull proportional hazards model,
this distribution must first be translated into a univariate beta design
prior for the control survival probability at some prespecified time.
This approximation can be done using <code><a href="approx_mvn_at_time.html">approx_mvn_at_time()</a></code>. If the
design priors in the vector indicated by <code>design_prior</code> differ across
iterations within a given scenario (e.g., using the IPW power prior as the
iteration-specific design prior), then the average distribution will be
plotted (i.e., a distribution of the same family with the hyperparameters
averaged across iterations).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Best, N., Ajimi, M., Neuenschwander, B., Saint-Hilary, G., &amp; Wandel, S.
(2024). Beyond the Classical Type I Error: Bayesian Metrics for Bayesian
Designs Using Informative Priors. <em>Statistics in Biopharmaceutical Research</em>,
17(2), 183–196. <a href="https://doi.org/10.1080/19466315.2024.2342817" class="external-link">doi:10.1080/19466315.2024.2342817</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Assuming binary_sim_df is a data frame with simulation results in the shape</span></span></span>
<span class="r-in"><span><span class="co"># of binary template code</span></span></span>
<span class="r-in"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">sweet_spot_plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  .data <span class="op">=</span> <span class="va">binary_sim_df</span>,</span></span>
<span class="r-in"><span>  scenario_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"population"</span>, <span class="st">"marg_trt_eff"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  trt_diff <span class="op">=</span> <span class="va">marg_trt_eff</span>,</span></span>
<span class="r-in"><span>  control_marg_param <span class="op">=</span> <span class="va">true_control_RR</span>,</span></span>
<span class="r-in"><span>  h0_prob <span class="op">=</span> <span class="va">reject_H0_yes</span>,</span></span>
<span class="r-in"><span>  h0_prob_no_borrowing <span class="op">=</span> <span class="va">no_borrowing_reject_H0_yes</span>,</span></span>
<span class="r-in"><span>  design_prior <span class="op">=</span> <span class="va">pwr_prior</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display the first plot</span></span></span>
<span class="r-in"><span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-plt img"><img src="sweet_spot_plot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tte_plots</span> <span class="op">&lt;-</span> <span class="va">tte_sim_df</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>beta_appox <span class="op">=</span> <span class="fu"><a href="approx_mvn_at_time.html">approx_mvn_at_time</a></span><span class="op">(</span><span class="va">mix_prior</span>, time <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span> <span class="fu">sweet_spot_plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>   scenario_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"population"</span>, <span class="st">"marg_trt_eff"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   trt_diff <span class="op">=</span> <span class="va">marg_trt_eff</span>,</span></span>
<span class="r-in"><span>   control_marg_param <span class="op">=</span> <span class="va">true_control_surv_prob</span>,</span></span>
<span class="r-in"><span>   h0_prob <span class="op">=</span> <span class="va">reject_H0_yes</span>,</span></span>
<span class="r-in"><span>   h0_prob_no_borrowing <span class="op">=</span> <span class="va">no_borrowing_reject_H0_yes</span>,</span></span>
<span class="r-in"><span>   design_prior <span class="op">=</span> <span class="va">beta_appox</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tte_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-plt img"><img src="sweet_spot_plot-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christina Fillmore, Nate Bean, Abi Terry, Ben Arancibia, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer></div>






  </body></html>

