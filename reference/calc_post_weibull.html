<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate Posterior Weibull — calc_post_weibull • beastt</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Posterior Weibull — calc_post_weibull"><meta property="og:description" content="Calculate a posterior distribution for the probability of
surviving past a given analysis time(s) for time-to-event data with a
Weibull likelihood. Only the relevant treatment arms from the internal
dataset should be read in (e.g., only the control arm if constructing a
posterior distribution for the control survival probability)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beastt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/binary.html">Binary Outcome</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Normal Outcome (Known SD)</a>
    </li>
    <li>
      <a href="../articles/tte.html">Time-to-Event Outcome</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/GSK-Biostatistics/beastt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Posterior Weibull</h1>
    <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/main/R/post.R" class="external-link"><code>R/post.R</code></a></small>
    <div class="hidden name"><code>calc_post_weibull.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate a posterior distribution for the probability of
surviving past a given analysis time(s) for time-to-event data with a
Weibull likelihood. Only the relevant treatment arms from the internal
dataset should be read in (e.g., only the control arm if constructing a
posterior distribution for the control survival probability).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_post_weibull</span><span class="op">(</span><span class="va">internal_data</span>, <span class="va">response</span>, <span class="va">event</span>, <span class="va">prior</span>, <span class="va">analysis_time</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-internal-data">internal_data<a class="anchor" aria-label="anchor" href="#arg-internal-data"></a></dt>
<dd><p>This can either be a propensity score object or a tibble
of the internal data.</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>Name of response variable</p></dd>


<dt id="arg-event">event<a class="anchor" aria-label="anchor" href="#arg-event"></a></dt>
<dd><p>Name of event indicator variable (1: event; 0: censored)</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>A distributional object corresponding to a multivariate normal
distribution or a mixture of 2 multivariate normals. The first element
of the mean vector and the first row/column of covariance matrix correspond
to the log-shape parameter, and the second element corresponds to the intercept
(i.e., log-inverse-scale) parameter.</p></dd>


<dt id="arg-analysis-time">analysis_time<a class="anchor" aria-label="anchor" href="#arg-analysis-time"></a></dt>
<dd><p>Vector of time(s) when survival probabilities will be
calculated</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>rstan sampling option. This overrides any default options. For more
information, see <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>stan posterior object</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>For a given arm of an internal trial (e.g., the control arm or an
active treatment arm) of size \(N_I\), suppose the response data are time to event
such that \(Y_i \sim \mbox{Weibull}(\alpha, \sigma)\), where</p>
<p>$$f(y_i \mid \alpha, \sigma) = \left( \frac{\alpha}{\sigma} \right) \left( \frac{y_i}{\sigma}
  \right)^{\alpha - 1} \exp \left( -\left( \frac{y_i}{\sigma} \right)^\alpha
  \right),$$</p>
<p>\(i=1,\ldots,N_I\). Define \(\boldsymbol{\theta} = \{\log(\alpha), \beta\}\)
where \(\beta = -\log(\sigma)\) is the intercept parameter of a Weibull
proportional hazards regression model. The posterior distribution for
\(\boldsymbol{\theta}\) is written as</p>
<p>$$\pi( \boldsymbol{\theta} \mid \boldsymbol{y}, \boldsymbol{\nu} ) \propto
  \mathcal{L}(\boldsymbol{\theta} \mid \boldsymbol{y}, \boldsymbol{\nu}) \;
  \pi(\boldsymbol{\theta}),$$</p>
<p>where \(\mathcal{L}(\boldsymbol{\theta} \mid \boldsymbol{y}, \boldsymbol{\nu}) =
  \prod_{i=1}^{N_I} f(y_i \mid \boldsymbol{\theta})^{\nu_i} S(y_i \mid \boldsymbol{\theta})^{1 - \nu_i}\)
is the likelihood of the response data from the internal arm with event indicator
\(\boldsymbol{\nu}\) and survival function \(S(y_i \mid \boldsymbol{\theta}) =
  1 - F(y_i \mid \boldsymbol{\theta})\), and \(\pi(\boldsymbol{\theta})\) is a prior
distribution on \(\boldsymbol{\theta}\) (either a multivariate normal distribution or a
mixture of two multivariate normal distributions). Note that the posterior distribution
for \(\boldsymbol{\theta}\) does not have a closed form, and thus MCMC samples
for \(\log(\alpha)\) and \(\beta\) are drawn from the posterior. These MCMC
samples are used to construct samples from the posterior distribution
for the probability of surviving past the specified analysis time(s) for the
given arm.</p>
<p>To construct a posterior distribution for the treatment difference (i.e., the
difference in survival probabilities at the specified analysis time), obtain MCMC
samples from the posterior distributions for the survival probabilities under
each arm and then subtract the control-arm samples from the treatment-arm
samples.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/" class="external-link">distributional</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: StanHeaders</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rstan version 2.32.6 (Stan version 2.32.2)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> options(mc.cores = parallel::detectCores()).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> To avoid recompilation of unchanged Stan programs, we recommend calling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rstan_options(auto_write = TRUE)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> change `threads_per_chain` option:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rstan_options(threads_per_chain = 1)</span>
<span class="r-in"><span><span class="va">mvn_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_multivariate_normal.html" class="external-link">dist_multivariate_normal</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">2.6</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">1.1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">post_treated</span> <span class="op">&lt;-</span> <span class="fu">calc_post_weibull</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_tte_df</span>, <span class="va">trt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  response <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>                                  event <span class="op">=</span> <span class="va">event</span>,</span></span>
<span class="r-in"><span>                                  prior <span class="op">=</span> <span class="va">mvn_prior</span>,</span></span>
<span class="r-in"><span>                                  analysis_time <span class="op">=</span> <span class="fl">12</span>,</span></span>
<span class="r-in"><span>                                  warmup <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                                  iter <span class="op">=</span> <span class="fl">15000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Extract MCMC samples of survival probabilities at time t=12</span></span></span>
<span class="r-in"><span><span class="va">surv_prob_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">post_treated</span>,</span></span>
<span class="r-in"><span>                                   pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"survProb"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christina Fillmore, Ben Arancibia, Nate Bean, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

