<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Conditional Drift and Treatment Effect for Binary Outcome Models — calc_cond_binary • beastt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Conditional Drift and Treatment Effect for Binary Outcome Models — calc_cond_binary"><meta name="description" content="In order to properly generate binary response data for the internal trial as
part of a simulation study that investigates inverse probability weighting,
we need to translate the desired marginal drift and treatment effect to the
corresponding conditional drift and treatment effect that can then be added
into a binary outcome model (e.g., logistic regression model) used to
simulate response data."><meta property="og:description" content="In order to properly generate binary response data for the internal trial as
part of a simulation study that investigates inverse probability weighting,
we need to translate the desired marginal drift and treatment effect to the
corresponding conditional drift and treatment effect that can then be added
into a binary outcome model (e.g., logistic regression model) used to
simulate response data."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">beastt</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/binary.html">Binary Outcome</a></li>
    <li><a class="dropdown-item" href="../articles/continuous.html">Normal Outcome (Known SD)</a></li>
    <li><a class="dropdown-item" href="../articles/tte.html">Time-to-Event Outcome</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GSK-Biostatistics/beastt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Conditional Drift and Treatment Effect for Binary Outcome Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/GSK-Biostatistics/beastt/blob/main/R/binary-sim.R" class="external-link"><code>R/binary-sim.R</code></a></small>
      <div class="d-none name"><code>calc_cond_binary.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In order to properly generate binary response data for the internal trial as
part of a simulation study that investigates inverse probability weighting,
we need to translate the desired marginal drift and treatment effect to the
corresponding conditional drift and treatment effect that can then be added
into a binary outcome model (e.g., logistic regression model) used to
simulate response data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_cond_binary</span><span class="op">(</span><span class="va">population</span>, <span class="va">glm</span>, <span class="va">marg_drift</span>, <span class="va">marg_trt_eff</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-population">population<a class="anchor" aria-label="anchor" href="#arg-population"></a></dt>
<dd><p>A very large data frame (e.g., number of rows \(\ge\)
100,000) where the columns correspond to the covariates defined in the
logistic regression model object. This data frame should be constructed to
represent the population of the internal trial according to the assumed
covariate distributions (possibly imbalanced from the external data).</p></dd>


<dt id="arg-glm">glm<a class="anchor" aria-label="anchor" href="#arg-glm"></a></dt>
<dd><p>Logistic regression model object fit using the external data</p></dd>


<dt id="arg-marg-drift">marg_drift<a class="anchor" aria-label="anchor" href="#arg-marg-drift"></a></dt>
<dd><p>Vector of marginal drift values</p></dd>


<dt id="arg-marg-trt-eff">marg_trt_eff<a class="anchor" aria-label="anchor" href="#arg-marg-trt-eff"></a></dt>
<dd><p>Vector of marginal treatment effect values</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>tibble of all combinations of the marginal drift and treatment
effect. For each row the conditional drift and treatment effect has been
calculated as well as the true control response rate and true treatment
effect.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In simulation studies that investigate the properties of inverse
probability weighted Bayesian dynamic borrowing, scenarios should be
considered in which the underlying response rates for the internal and
external control populations differ by varying amounts due to unmeasured
confounding (i.e., drift, where positive values indicate a higher response
rate for the internal population). While values of drift and treatment
effect (i.e., risk difference) can be defined on the marginal scale for
simulation studies, we must first convert these values to the conditional
scale and then include these terms, along with covariates, in a logistic
regression outcome model when generating response data for the internal
arms. Doing so allows us to assume a relationship between the covariates
and the response variable while properly accounting for drift and treatment
effect.</p>
<p>To identify the conditional drift and treatment effect that correspond to
specified values of marginal drift and treatment effect, we first bootstrap
covariate vectors from the external data (e.g., \(N \ge 100,000\)) to
construct a "population" that represents both the internal trial
(possibly incorporating intentional covariate imbalance) and the external
trial <em>after</em> standardizing it to match the covariate distributions
of the internal trial (allowing us to control for measured confounding
from potential imbalance in the covariate distributions). Measured
confounding can be incorporated into the data generation by bootstrapping
a very large data frame (<code>population</code>) in which the distribution of at
least one covariate is intentionally varied from that of the external data;
additional <em>unmeasured</em> drift can be incorporated through the
translation of specified marginal values (<code>marg_drift</code>) to conditional
values.</p>
<p>Let \(\Delta\) and \(\delta\) denote the marginal and conditional drift,
respectively. For a specified value of \(\Delta\), we can identify the
corresponding \(\delta\) as the value that, when added as an additional
term in the logistic regression model (i.e., change in the intercept) for
each individual in the population, increases/decreases the
population-averaged conditional probabilities of response by an amount
approximately equal to \(\Delta\). That is, the optimal \(\delta\)
minimizes</p>
<p>$$\left| \left( \frac{1}{N} \sum_{i=1}^N \frac{\exp \left(
  \boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta \right)}{1 +
  \exp\left(\boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta \right)}
  - \frac{1}{N} \sum_{i=1}^N \frac{\exp \left(
  \boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} \right)}{1 +
  \exp \left(\boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} \right)}
  \right) - \Delta \right|,$$</p>
<p>where \(\boldsymbol{\beta}_{EC}\) is the vector of regression coefficients
from the logistic regression model (<code>glm</code>) fit to the external control data
(assumed here to be the "true" covariate effects when generating response
data) and \(\boldsymbol{x}_i\) is a vector of covariates from the
bootstrapped population of size \(N\). In the formula above, the first
and second terms correspond to the population-averaged conditional
probabilities (i.e., the marginal response rates) of the internal control
population with drift and the external control population (with covariate
distributions standardized to match the internal trial), respectively.</p>
<p>If we now denote the marginal and conditional treatment effect by
\(\Gamma\) and \(\gamma\), respectively, we can use a similar process
to identify the optimal \(\gamma\) that approximately corresponds to the
specified value of \(\Gamma\), which is done by minimizing the following:</p>
<p>$$\left| \left( \frac{1}{N} \sum_{i=1}^N \frac{\exp \left(
  \boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta + \gamma \right)}{1 +
  \exp\left(\boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta + \gamma \right)}
  - \frac{1}{N} \sum_{i=1}^N \frac{\exp \left(
  \boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta \right)}{1 +
  \exp \left(\boldsymbol{x}_i^\prime \boldsymbol{\beta}_{EC} + \delta \right)}
  \right) - \Gamma \right|,$$</p>
<p>where the first term is the population-averaged conditional probabilities
(i.e., the marginal response rate) of the internal treated population.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="co"># Model "true" regression coefficients using the external data</span></span></span>
<span class="r-in"><span><span class="va">logit_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span>, data <span class="op">=</span> <span class="va">ex_binary_df</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bootstrap internal control "population" with imbalance w.r.t. covariate 2</span></span></span>
<span class="r-in"><span><span class="va">pop_int_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="bootstrap_cov.html">bootstrap_cov</a></span><span class="op">(</span><span class="va">ex_binary_df</span>, n <span class="op">=</span> <span class="fl">100000</span>, imbal_var <span class="op">=</span> <span class="va">cov2</span>,</span></span>
<span class="r-in"><span>                              imbal_prop <span class="op">=</span> <span class="fl">0.25</span>, ref_val <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>                              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">subjid</span>, <span class="op">-</span><span class="va">y</span><span class="op">)</span>  <span class="co"># keep only covariate columns</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert the marginal drift and treatment effects to conditional</span></span></span>
<span class="r-in"><span><span class="fu">calc_cond_binary</span><span class="op">(</span>population <span class="op">=</span> <span class="va">pop_int_ctrl</span>, glm <span class="op">=</span> <span class="va">logit_mod</span>,</span></span>
<span class="r-in"><span>                 marg_drift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.1</span>, <span class="fl">0</span>, <span class="fl">.1</span><span class="op">)</span>, marg_trt_eff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   marg_drift marg_trt_eff conditional_drift true_control_RR conditional_trt_eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>       -<span style="color: #BB0000;">0.1</span>         0               -<span style="color: #BB0000;">0.413</span>           0.446               0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>       -<span style="color: #BB0000;">0.1</span>         0.15            -<span style="color: #BB0000;">0.413</span>           0.446               0.623</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>        0           0                0               0.546               0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>        0           0.15             0               0.546               0.660</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>        0.1         0                0.428           0.646               0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span>        0.1         0.15             0.428           0.646               0.776</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: true_trt_RR &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christina Fillmore, Ben Arancibia, Nate Bean, Abi Terry, GlaxoSmithKline Research &amp; Development Limited.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

